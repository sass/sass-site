<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang=en lang=en> <head> <meta http-equiv=Content-Type content="text/html; charset=utf-8"/> <title> Class: Sass::Source::Map &mdash; Sass Documentation </title> <link rel=stylesheet href="../../css/style-03d6d7d0.css" charset=utf-8 /> <link rel=stylesheet href="../../../assets/css/docs-eb9372d5.css" charset=utf-8 /> <script charset=utf-8>
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Sass/Source/Map.html";
</script> <script charset=utf-8 src="../../js/jquery-89b1e99e.js"></script> <script charset=utf-8 src="../../js/app-760e64ba.js"></script> </head> <body> <div id=header> <div id=menu> <a href="../../_index.html">Index (M)</a> &raquo; <span class=title><span class=object_link><a href="../../Sass.html" title="Sass (module)">Sass</a></span></span> &raquo; <span class=title><span class=object_link><a href="../Source.html" title="Sass::Source (module)">Source</a></span></span> &raquo; <span class=title>Map</span> <div class=noframes><span class=title>(</span><a href="." target=_top>no frames</a><span class=title>)</span></div> </div> <div id=search> <a class=full_list_link id=class_list_link href="../../class_list.html"> Class List </a> <a class=full_list_link id=method_list_link href="../../method_list.html"> Method List </a> <a class=full_list_link id=file_list_link href="../../file_list.html"> File List </a> </div> <div class=clear></div> </div> <iframe id=search_frame></iframe> <div id=content><h1>Class: Sass::Source::Map </h1> <dl class=box> <dt class=r1>Inherits:</dt> <dd class=r1> <span class=inheritName>Object</span> <ul class=fullTree> <li>Object</li> <li class=next>Sass::Source::Map</li> </ul> <a href="#" class=inheritanceTree>show all</a> </dd> <dt class="r2 last">Defined in:</dt> <dd class="r2 last">/home/nweiz/code/sass-site/.sass/lib/sass/source/map.rb</dd> </dl> <div class=clear></div> <h2>Defined Under Namespace</h2> <p class=children> <strong class=classes>Classes:</strong> <span class=object_link><a href="Map/Mapping.html" title="Sass::Source::Map::Mapping (class)">Mapping</a></span> </p> <h2>Instance Attribute Summary <small>(<a href="#" class=summary_toggle>collapse</a>)</small></h2> <ul class=summary> <li class="public "> <span class=summary_signature> <a href="#data-instance_method" title="#data (instance method)">- (Array&lt;Mapping&gt;) <strong>data</strong> </a> </span> <span class="note title readonly">readonly</span> <span class=summary_desc><div class=inline> <p>The mapping data ordered by the location in the target.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#input-instance_method" title="#input (instance method)">- (Sass::Source::Range) <strong>input</strong> </a> </span> <span class=summary_desc><div class=inline> <p>The source range in the input document.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#output-instance_method" title="#output (instance method)">- (Sass::Source::Range) <strong>output</strong> </a> </span> <span class=summary_desc><div class=inline> <p>The source range in the output document.</p> </div></span> </li> </ul> <h2> Instance Method Summary <small>(<a href="#" class=summary_toggle>collapse</a>)</small> </h2> <ul class=summary> <li class="public "> <span class=summary_signature> <a href="#add-instance_method" title="#add (instance method)">- <strong>add</strong>(input, output) </a> </span> <span class=summary_desc><div class=inline> <p>Adds a new mapping from one source range to another.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#initialize-instance_method" title="#initialize (instance method)">- (Map) <strong>initialize</strong> </a> </span> <span class="note title constructor">constructor</span> <span class=summary_desc><div class=inline> <p>A new instance of Map.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#shift_output_lines-instance_method" title="#shift_output_lines (instance method)">- <strong>shift_output_lines</strong>(delta) </a> </span> <span class=summary_desc><div class=inline> <p>Shifts all output source ranges forward one or more lines.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#shift_output_offsets-instance_method" title="#shift_output_offsets (instance method)">- <strong>shift_output_offsets</strong>(delta) </a> </span> <span class=summary_desc><div class=inline> <p>Shifts any output source ranges that lie on the first line forward one or more characters on that line.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#to_json-instance_method" title="#to_json (instance method)">- (String) <strong>to_json</strong>(options) </a> </span> <span class=summary_desc><div class=inline> <p>Returns the standard JSON representation of the source map.</p> </div></span> </li> </ul> <div id=constructor_details class=method_details_list> <h2>Constructor Details</h2> <div class="method_details first"> <h3 class="signature first" id=initialize-instance_method> - (<tt><span class=object_link><a href="" title="Sass::Source::Map (class)">Map</a></span></tt>) <strong>initialize</strong> </h3><div class=docstring> <div class=discussion> <p>Returns a new instance of Map</p> </div> </div> <div class=tags> </div><table class=source_code> <tr> <td> <pre class=lines>


23
24
25</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/source/map.rb', line 23</span>

def initialize
  @data = []
end</pre> </td> </tr> </table> </div> </div> <div id=instance_attr_details class=attr_details> <h2>Instance Attribute Details</h2> <span id=""></span> <div class="method_details first"> <h3 class="signature first" id=data-instance_method> - (<tt>Array&lt;<span class=object_link><a href="Map/Mapping.html" title="Sass::Source::Map::Mapping (class)">Mapping</a></span>&gt;</tt>) <strong>data</strong> <span class=extras>(readonly)</span> </h3><div class=docstring> <div class=discussion> <p>The mapping data ordered by the location in the target.</p> </div> </div> <div class=tags> <p class=tag_title>Returns:</p> <ul class=return> <li> <span class=type>(<tt>Array&lt;<span class=object_link><a href="Map/Mapping.html" title="Sass::Source::Map::Mapping (class)">Mapping</a></span>&gt;</tt>)</span> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


21
22
23</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/source/map.rb', line 21</span>

def data
  @data
end</pre> </td> </tr> </table> </div> <span id="input=-instance_method"></span> <div class="method_details "> <h3 class="signature " id=input-instance_method> - (<tt><span class=object_link><a href="Range.html" title="Sass::Source::Range (class)">Sass::Source::Range</a></span></tt>) <strong>input</strong> </h3><div class=docstring> <div class=discussion> <p>Returns The source range in the input document.</p> </div> </div> <div class=tags> <p class=tag_title>Returns:</p> <ul class=return> <li> <span class=type>(<tt><span class=object_link><a href="Range.html" title="Sass::Source::Range (class)">Sass::Source::Range</a></span></tt>)</span> &mdash; <div class=inline> <p>The source range in the input document.</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


11
12
13
14
15
16</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/source/map.rb', line 11</span>

class Mapping &lt; Struct.new(:input, :output)
  # @return [String] A string representation of the mapping.
  def inspect
    &quot;#{input.inspect} =&gt; #{output.inspect}&quot;
  end
end</pre> </td> </tr> </table> </div> <span id="output=-instance_method"></span> <div class="method_details "> <h3 class="signature " id=output-instance_method> - (<tt><span class=object_link><a href="Range.html" title="Sass::Source::Range (class)">Sass::Source::Range</a></span></tt>) <strong>output</strong> </h3><div class=docstring> <div class=discussion> <p>Returns The source range in the output document.</p> </div> </div> <div class=tags> <p class=tag_title>Returns:</p> <ul class=return> <li> <span class=type>(<tt><span class=object_link><a href="Range.html" title="Sass::Source::Range (class)">Sass::Source::Range</a></span></tt>)</span> &mdash; <div class=inline> <p>The source range in the output document.</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


11
12
13
14
15
16</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/source/map.rb', line 11</span>

class Mapping &lt; Struct.new(:input, :output)
  # @return [String] A string representation of the mapping.
  def inspect
    &quot;#{input.inspect} =&gt; #{output.inspect}&quot;
  end
end</pre> </td> </tr> </table> </div> </div> <div id=instance_method_details class=method_details_list> <h2>Instance Method Details</h2> <div class="method_details first"> <h3 class="signature first" id=add-instance_method> - <strong>add</strong>(input, output) </h3><div class=docstring> <div class=discussion> <p>Adds a new mapping from one source range to another. Multiple invocations of this method should have each <code>output</code> range come after all previous ranges.</p> </div> </div> <div class=tags> <p class=tag_title>Parameters:</p> <ul class=param> <li> <span class=name>input</span> <span class=type>(<tt><span class=object_link><a href="Range.html" title="Sass::Source::Range (class)">Sass::Source::Range</a></span></tt>)</span> &mdash; <div class=inline> <p>The source range in the input document.</p> </div> </li> <li> <span class=name>output</span> <span class=type>(<tt><span class=object_link><a href="Range.html" title="Sass::Source::Range (class)">Sass::Source::Range</a></span></tt>)</span> &mdash; <div class=inline> <p>The source range in the output document.</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


34
35
36</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/source/map.rb', line 34</span>

def add(input, output)
  @data.push(Mapping.new(input, output))
end</pre> </td> </tr> </table> </div> <div class="method_details "> <h3 class="signature " id=shift_output_lines-instance_method> - <strong>shift_output_lines</strong>(delta) </h3><div class=docstring> <div class=discussion> <p>Shifts all output source ranges forward one or more lines.</p> </div> </div> <div class=tags> <p class=tag_title>Parameters:</p> <ul class=param> <li> <span class=name>delta</span> <span class=type>(<tt>Fixnum</tt>)</span> &mdash; <div class=inline> <p>The number of lines to shift the ranges forward.</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


41
42
43
44
45
46
47</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/source/map.rb', line 41</span>

def shift_output_lines(delta)
  return if delta == 0
  @data.each do |m|
    m.output.start_pos.line += delta
    m.output.end_pos.line += delta
  end
end</pre> </td> </tr> </table> </div> <div class="method_details "> <h3 class="signature " id=shift_output_offsets-instance_method> - <strong>shift_output_offsets</strong>(delta) </h3><div class=docstring> <div class=discussion> <p>Shifts any output source ranges that lie on the first line forward one or more characters on that line.</p> </div> </div> <div class=tags> <p class=tag_title>Parameters:</p> <ul class=param> <li> <span class=name>delta</span> <span class=type>(<tt>Fixnum</tt>)</span> &mdash; <div class=inline> <p>The number of characters to shift the ranges forward.</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


54
55
56
57
58
59
60
61</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/source/map.rb', line 54</span>

def shift_output_offsets(delta)
  return if delta == 0
  @data.each do |m|
    break if m.output.start_pos.line &gt; 1
    m.output.start_pos.offset += delta
    m.output.end_pos.offset += delta if m.output.end_pos.line &gt; 1
  end
end</pre> </td> </tr> </table> </div> <div class="method_details "> <h3 class="signature " id=to_json-instance_method> - (<tt>String</tt>) <strong>to_json</strong>(options) </h3><div class=docstring> <div class=discussion> <p>Returns the standard JSON representation of the source map.</p> <p>If the <code>:css_uri</code> option isn’t specified, the <code>:css_path</code> and <code>:sourcemap_path</code> options must both be specified. Any options may also be specified alongside the <code>:css_uri</code> option. If <code>:css_uri</code> isn’t specified, it will be inferred from <code>:css_path</code> and <code>:sourcemap_path</code> using the assumption that the local file system has the same layout as the server.</p> <p>Regardless of which options are passed to this method, source stylesheets that are imported using a non-default importer will only be linked to in the source map if their importers implement <span class=object_link><a href="../Importers/Base.html#public_url-instance_method" title="Sass::Importers::Base#public_url (method)">Importers::Base#public_url</a></span>.</p> </div> </div> <div class=tags> <p class=tag_title>Parameters:</p> <ul class=param> <li> <span class=name>options</span> <span class=type>(<tt>Hash</tt>)</span> &mdash; <div class=inline> <p>a customizable set of options</p> </div> </li> </ul> <p class=tag_title>Options Hash (<tt>options</tt>):</p> <ul class=option> <li> <span class=name>:css_uri</span> <span class=type>(<tt>String</tt>)</span> <span class=default> </span> &mdash; <div class=inline> <p>The publicly-visible URI of the CSS output file.</p> </div> </li> <li> <span class=name>:css_path</span> <span class=type>(<tt>String</tt>)</span> <span class=default> </span> &mdash; <div class=inline> <p>The local path of the CSS output file.</p> </div> </li> <li> <span class=name>:sourcemap_path</span> <span class=type>(<tt>String</tt>)</span> <span class=default> </span> &mdash; <div class=inline> <p>The (eventual) local path of the sourcemap file.</p> </div> </li> <li> <span class=name>:type</span> <span class=type>(<tt>Symbol</tt>)</span> <span class=default> </span> &mdash; <div class=inline> <p><code>:auto</code> (default), <code>:file</code>, or <code>:inline</code>.</p> </div> </li> </ul> <p class=tag_title>Returns:</p> <ul class=return> <li> <span class=type>(<tt>String</tt>)</span> &mdash; <div class=inline> <p>The JSON string.</p> </div> </li> </ul> <p class=tag_title>Raises:</p> <ul class=raise> <li> <span class=type>(<tt>ArgumentError</tt>)</span> &mdash; <div class=inline> <p>If neither <code>:css_uri</code> nor <code>:css_path</code> and <code>:sourcemap_path</code> are specified.</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/source/map.rb', line 89</span>

def to_json(options)
  css_uri, css_path, sourcemap_path =
    options[:css_uri], options[:css_path], options[:sourcemap_path]
  unless css_uri || (css_path &amp;&amp; sourcemap_path)
    raise ArgumentError.new(&quot;Sass::Source::Map#to_json requires either &quot; \
      &quot;the :css_uri option or both the :css_path and :soucemap_path options.&quot;)
  end
  css_path &amp;&amp;= Sass::Util.pathname(Sass::Util.absolute_path(css_path))
  sourcemap_path &amp;&amp;= Sass::Util.pathname(Sass::Util.absolute_path(sourcemap_path))
  css_uri ||= Sass::Util.file_uri_from_path(
    Sass::Util.relative_path_from(css_path, sourcemap_path.dirname))

  result = &quot;{\n&quot;
  write_json_field(result, &quot;version&quot;, 3, true)

  source_uri_to_id = {}
  id_to_source_uri = {}
  id_to_contents = {} if options[:type] == :inline
  next_source_id = 0
  line_data = []
  segment_data_for_line = []

  # These track data necessary for the delta coding.
  previous_target_line = nil
  previous_target_offset = 1
  previous_source_line = 1
  previous_source_offset = 1
  previous_source_id = 0

  @data.each do |m|
    file, importer = m.input.file, m.input.importer

    if options[:type] == :inline
      source_uri = file
    else
      sourcemap_dir = sourcemap_path &amp;&amp; sourcemap_path.dirname.to_s
      sourcemap_dir = nil if options[:type] == :file
      source_uri = importer &amp;&amp; importer.public_url(file, sourcemap_dir)
      next unless source_uri
    end

    current_source_id = source_uri_to_id[source_uri]
    unless current_source_id
      current_source_id = next_source_id
      next_source_id += 1

      source_uri_to_id[source_uri] = current_source_id
      id_to_source_uri[current_source_id] = source_uri

      if options[:type] == :inline
        id_to_contents[current_source_id] =
          importer.find(file, {}).instance_variable_get(&#39;@template&#39;)
      end
    end

    [
      [m.input.start_pos, m.output.start_pos],
      [m.input.end_pos, m.output.end_pos]
    ].each do |source_pos, target_pos|
      if previous_target_line != target_pos.line
        line_data.push(segment_data_for_line.join(&quot;,&quot;)) unless segment_data_for_line.empty?
        (target_pos.line - 1 - (previous_target_line || 0)).times {line_data.push(&quot;&quot;)}
        previous_target_line = target_pos.line
        previous_target_offset = 1
        segment_data_for_line = []
      end

      # `segment` is a data chunk for a single position mapping.
      segment = &quot;&quot;

      # Field 1: zero-based starting offset.
      segment &lt;&lt; Sass::Util.encode_vlq(target_pos.offset - previous_target_offset)
      previous_target_offset = target_pos.offset

      # Field 2: zero-based index into the &quot;sources&quot; list.
      segment &lt;&lt; Sass::Util.encode_vlq(current_source_id - previous_source_id)
      previous_source_id = current_source_id

      # Field 3: zero-based starting line in the original source.
      segment &lt;&lt; Sass::Util.encode_vlq(source_pos.line - previous_source_line)
      previous_source_line = source_pos.line

      # Field 4: zero-based starting offset in the original source.
      segment &lt;&lt; Sass::Util.encode_vlq(source_pos.offset - previous_source_offset)
      previous_source_offset = source_pos.offset

      segment_data_for_line.push(segment)

      previous_target_line = target_pos.line
    end
  end
  line_data.push(segment_data_for_line.join(&quot;,&quot;))
  write_json_field(result, &quot;mappings&quot;, line_data.join(&quot;;&quot;))

  source_names = []
  (0...next_source_id).each {|id| source_names.push(id_to_source_uri[id].to_s)}
  write_json_field(result, &quot;sources&quot;, source_names)

  if options[:type] == :inline
    write_json_field(result, &quot;sourcesContent&quot;,
      (0...next_source_id).map {|id| id_to_contents[id]})
  end

  write_json_field(result, &quot;names&quot;, [])
  write_json_field(result, &quot;file&quot;, css_uri)

  result &lt;&lt; &quot;\n}&quot;
  result
end</pre> </td> </tr> </table> </div> </div> </div> <div id=footer> Generated on Thu Feb 26 18:31:30 2015 by <a href="//yardoc.org" title="Yay! A Ruby Documentation Tool" target=_parent>yard</a> 0.8.7.4 (ruby-2.0.0). </div> </body> </html>